alias: "EMHASS (Charge) 23:00-05:00 FC 4500W Power "
description: ...
trigger:
  - platform: state
    entity_id:
      - sensor.soc_batt_forecast
    enabled: true
    id: "SOC Forecast Change "
  - platform: time_pattern
    minutes: /5
    enabled: true
condition:
  - condition: time
    after: "23:00:00"
    before: "05:00:00"
  - condition: numeric_state
    entity_id: sensor.p_batt_forecast
    below: -5
    enabled: true
action:
  - service: huawei_solar.forcible_charge_soc
    data:
      target_soc: "{{ max(min(states('sensor.soc_batt_forecast') | int(0), 100), 12) }}"
      power: "4500"
      device_id: 6893ee838a0972bd3e50d9e0faa0ba5a
    enabled: true
    alias: " Forcible Charge to a SoC level 4500W"
  - delay:
      hours: 0
      minutes: 0
      seconds: 3
      milliseconds: 0
  - service: number.set_value
    metadata: {}
    data:
      value: "4500"
    target:
      entity_id: number.battery_maximum_charging_power
    enabled: true
    alias: Maximum charging power 4500W
  - service: number.set_value
    metadata: {}
    data:
      value: "0"
    target:
      entity_id:
        - number.battery_maximum_discharging_power
    alias: Maximum discharging power 0W
mode: queued
max: 2
