alias: Predbat Status Hold, Freeze V2
description: ""
triggers:
  - entity_id:
      - predbat.status
    for:
      hours: 0
      minutes: 0
      seconds: 0
    id: predbat_status_Hold_charging
    trigger: state
    to: Hold charging
  - entity_id:
      - predbat.status
    for:
      hours: 0
      minutes: 0
      seconds: 0
    id: predbat_status_Hold_exporting
    trigger: state
    to: Freeze charging
  - entity_id:
      - predbat.status
    for:
      hours: 0
      minutes: 0
      seconds: 0
    id: predbat_status_Hold_exporting
    trigger: state
    to: Hold exporting
  - entity_id:
      - predbat.status
    for:
      hours: 0
      minutes: 0
      seconds: 0
    id: predbat_status_Freeze_exporting
    trigger: state
    to: Freeze exporting
  - trigger: homeassistant
    event: start
  - trigger: time_pattern
    minutes: /9
    id: time
    enabled: false
conditions:
  - condition: state
    entity_id: automation.emhass_combined_automation
    state: "off"
  - condition: state
    entity_id: automation.tibber_smartcharge
    state: "off"
actions:
  - alias: Predbat status Hold, Freeze exporting
    if:
      - condition: or
        conditions:
          - condition: state
            entity_id: predbat.status
            state: Freeze exporting
          - condition: state
            entity_id: predbat.status
            state: Hold exporting
    then:
      - action: huawei_solar.stop_forcible_charge
        data: {}
      - delay:
          hours: 0
          minutes: 0
          seconds: 5
          milliseconds: 0
      - action: script.huawei_charging_power_0w
        data: {}
        enabled: true
      - action: script.huawei_discharging_power_2500w
        data: {}
  - alias: Predbat status Hold charging
    if:
      - condition: or
        conditions:
          - condition: state
            entity_id: predbat.status
            state: Freeze charging
          - condition: state
            entity_id: predbat.status
            state: Hold charging
    then:
      - action: huawei_solar.stop_forcible_charge
        data:
          device_id: 6893ee838a0972bd3e50d9e0faa0ba5a
      - delay:
          hours: 0
          minutes: 0
          seconds: 5
          milliseconds: 0
      - action: script.emhass_discharging_power_0w
        metadata: {}
        data: {}
      - action: script.emhass_charging_power_2500
        metadata: {}
        data: {}
mode: parallel
max: 10
